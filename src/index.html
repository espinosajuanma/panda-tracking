<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panda Tracking</title>
    <link id="runtimeAppFavicon" rel="shortcut icon" type="image/png" href="/img/hourglass-done.png"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./vanilla-calendar.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script> <!-- Select2 needs jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="./vanilla-calendar.js"></script>

    <script src="./app.js"></script>
    <script>
        // Set theme from localStorage to prevent FOUC (Flash of Unstyled Content)
        (function() {
            const theme = localStorage.getItem('solutions:timetracking:theme') || 'dark';
            document.documentElement.setAttribute('data-bs-theme', theme);
        })();
    </script>
</head>
<body data-bind="attr: { 'data-bs-theme': theme }">
    <header>
        <nav class="navbar navbar-expand-lg mb-4 shadow-sm" data-bind="css: { 'navbar-dark bg-dark': isDarkMode(), 'navbar-light bg-light border-bottom': !isDarkMode() }">
            <div class="container">
                <a class="navbar-brand fw-bold" href="#">
                    <img src="/img/hourglass-done.png" alt="Logo" width="24" height="24" class="d-inline-block align-text-top me-2">
                    Panda Tracking
                </a>
                <div class="d-flex align-items-center">
                    <div class="form-check form-switch me-3" title="Toggle Vim Keybindings">
                        <input class="form-check-input" type="checkbox" role="switch" id="keybindingsSwitch" data-bind="checked: keybindingsEnabled">
                        <label class="form-check-label" for="keybindingsSwitch"><i class="bi bi-keyboard"></i></label>
                    </div>
                    <button class="btn btn-sm me-3" data-bind="click: showPomodoroModal, css: { 'btn-warning': pomodoroIsRunning() && !pomodoroFinished(), 'btn-danger': pomodoroFinished(), 'btn-outline-light': !pomodoroIsRunning() && isDarkMode(), 'btn-outline-dark': !pomodoroIsRunning() && !isDarkMode() }" title="Focus Mode (Pomodoro)">
                        <i class="bi bi-stopwatch" data-bind="css: { 'me-1': pomodoroIsRunning() && !isPomodoroModalVisible() }"></i>
                        <span data-bind="visible: pomodoroIsRunning() && !isPomodoroModalVisible(), text: pomodoroDisplayTime"></span>
                    </button>
                    <div class="form-check form-switch me-3">
                        <input class="form-check-input" type="checkbox" role="switch" id="themeSwitchNav" data-bind="checked: isDarkMode">
                        <label class="form-check-label" for="themeSwitchNav"><i data-bind="css: isDarkMode() ? 'bi-moon-stars-fill' : 'bi-sun-fill'"></i></label>
                    </div>
                    <!-- ko if: logged -->
                    <span class="navbar-text me-3 d-none d-md-inline" data-bind="text: slingr.user?.firstName"></span>
                    <button class="btn btn-sm" data-bind="click: logout, css: { 'btn-outline-light': isDarkMode(), 'btn-outline-dark': !isDarkMode() }">
                        <i class="bi bi-box-arrow-right"></i> <span class="d-none d-sm-inline">Logout</span>
                    </button>
                    <!-- /ko -->
                </div>
            </div>
        </nav>
    </header>

    <main class="container pb-5">

        <!-- LOGIN -->
        <div data-bind="hidden: logged" class="card shadow-sm" id="login">
            <div class="card-header">
                <h5 class="card-title mb-0">Solutions Login</h5>
            </div>
            <form data-bind="submit: login">
                <div class="card-body">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                        <input data-bind="value: email, attr: { disabled: logginIn }" type="email" name="email" class="form-control" id="email" placeholder="your@email.com" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password <span class="text-danger">*</span></label>
                        <input data-bind="value: pass, attr: { disabled: logginIn }" type="password" name="password" class="form-control" id="password" required>
                    </div>
                    <button data-bind="attr: { disabled: logginIn }" type="submit" class="mt-2 btn btn-primary w-100">Login</button>
                </div>
            </form>
            <div class="card-footer text-body-secondary small">
                <p class="mb-0">
                    <i class="bi bi-info-circle-fill me-1"></i>
                    <strong>Disclaimer:</strong> This is a <strong>third-party extension</strong> for the Slingr Solutions app and is not created or endorsed by the Slingr Solutions app development team. It does not collect or store personal data, such as your password. The app runs entirely in your browser to let you view projects, see time entries, and manage your time logs directly within your Slingr Solutions account. For full transparency, the source code is available via the link in the footer.
                </p>
            </div>
        </div>

        <!-- DASHBOARD -->
        <div data-bind="visible: logged, css: { loading: loading }" id="time-tracking-body">
            <div class="card shadow-sm mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Monthly Overview</h5>
                    <button data-bind="click: updateDashboard, attr: { disabled: loading }" class="btn btn-sm btn-outline-secondary"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                </div>
                <div class="card-body d-lg-flex justify-content-start align-items-start">
                    <!-- CALENDAR SELECTOR -->
                    <div id="calendar" class="me-lg-4 mb-4 mb-lg-0"></div>
                    <!-- STATS -->
                    <div id="stats" class="flex-grow-1">
                        <div class="mb-4 row">
                            <div class="col-md-5">
                                <div id="month-progress">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6>Month Progress</h6>
                                        <div>
                                            <span class="fw-bold" data-bind="text: monthProgress.total"></span>
                                        </div>
                                    </div>
                                    <div style="position: relative; height:150px; width: 150px; margin: auto;">
                                        <canvas id="monthScopeChart"></canvas>
                                    </div>
                                    <div class="d-flex justify-content-center flex-wrap mt-2 small text-muted" data-bind="foreach: monthProgress.scopes">
                                        <span class="mx-2 d-flex align-items-center">
                                            <i class="bi bi-circle-fill me-1" data-bind="css: textColor"></i>
                                            <span data-bind="text: name"></span>:
                                            <b class="ms-1" data-bind="text: duration"></b>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-7">
                                 <div id="projects">
                                    <h6 class="mt-2">Projects</h6>
                                    <div style="position: relative; height:200px">
                                        <canvas id="projectHoursChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ko if: monthProgress.missing() > 0 -->
                <div class="card-footer alert-warning">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-exclamation-triangle-fill me-3 fs-4 text-warning"></i>
                        <div>
                            <h6 class="alert-heading mb-0">Action Needed: <span data-bind="text: formatMsToDuration(monthProgress.missing())"></span> Missing</h6>
                            <small>You have unlogged hours. Use the "Missing Hours" filter to find them.</small>
                        </div>
                    </div>
                </div>
                <!-- /ko -->
            </div>

            <!-- Filters & Actions Toolbar -->
            <div class="d-md-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-2 mb-md-0">Month entries</h5>
                <div class="d-flex align-items-center small flex-wrap justify-content-start justify-content-md-end" style="gap: 1rem;">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="filterMissingHours" data-bind="checked: filterMissingHours">
                        <label class="form-check-label" for="filterMissingHours">Missing Hours</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="filterHideLeaveDays" data-bind="checked: filterHideLeaveDays">
                        <label class="form-check-label" for="filterHideLeaveDays">Hide Leaves</label>
                    </div>
                    <div class="form-check form-switch" data-bind="visible: isCurrentMonth">
                        <input class="form-check-input" type="checkbox" role="switch" id="filterOnlyToday" data-bind="checked: filterOnlyToday">
                        <label class="form-check-label" for="filterOnlyToday">Today Only</label>
                    </div>
                    <div class="form-check form-switch" data-bind="visible: isCurrentMonth">
                        <input class="form-check-input" type="checkbox" role="switch" id="filterOnlyCurrentWeek" data-bind="checked: filterOnlyCurrentWeek">
                        <label class="form-check-label" for="filterOnlyCurrentWeek">This Week</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="showWeekends" data-bind="checked: showWeekends">
                        <label class="form-check-label" for="showWeekends">Show Weekends</label>
                    </div>
                    <button data-bind="click: goToToday, attr: { disabled: loading }" class="btn btn-sm btn-outline-primary" title="Go to Today"><i class="bi bi-calendar-event"></i> Today</button>
                    <button data-bind="click: exportToCsv, attr: { disabled: loading }" class="btn btn-sm btn-outline-success" title="Export visible entries to CSV"><i class="bi bi-file-earmark-spreadsheet"></i> Export</button>
                </div>
            </div>
            <div class="row mb-3 g-2">
                <div class="col-md-6">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control" placeholder="Filter by notes (e.g. 'bug, fix, #urgent')" data-bind="textInput: filterByNotes">
                    </div>
                </div>
                <div class="col-md-6">
                    <select class="form-select form-select-sm" data-bind="options: projects, optionsText: 'name', optionsValue: 'id', value: filterByProject, optionsCaption: 'All Projects'"></select>
                </div>
            </div>
            <!-- DAYS -->
            <div id="entries">
                <!-- ko foreach: { data: weeks, as: 'week' } -->
                <div data-bind="visible: week.isVisible">
                    <h5 class="mt-4 d-flex justify-content-between align-items-center" data-bs-toggle="collapse" data-bind="attr: { 'data-bs-target': '#' + week.id }, click: week.toggleCollapse" style="cursor: pointer;">
                        <span>
                            <span data-bind="text: week.title"></span>
                            <small class="text-muted ms-2 fw-normal" data-bind="text: week.dateRange"></small>
                        </span>
                        <i class="bi" data-bind="css: { 'bi-chevron-down': !week.isCollapsed(), 'bi-chevron-up': week.isCollapsed() }"></i>
                    </h5>
                    <div class="collapse show" data-bind="attr: { id: week.id }">
                        <!-- ko foreach: { data: week.filteredDays, as: 'day' } -->
                        <div data-bind="attr: { id: dateStr(), tabindex: $root.keybindingsEnabled() ? 0 : null }, css: { 'border-primary': isToday(), 'border-warning': isHoliday() && !isLeave(), 'border-danger': isWeekend(), 'border-info': isLeave(), 'selected-day': $data === $root.selectedDay() }" class="card shadow-sm mt-3" style="outline: none;">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="card-title mb-0">
                                        <span data-bind="visible: isLeave()" title="Leave" data-bs-toggle="tooltip"><i class="bi bi-person-slash text-info"></i> </span>
                                        <span data-bind="visible: isHoliday() && !isLeave(), attr: { title: holidayDetail }" data-bs-toggle="tooltip"><i class="bi bi-calendar-x-fill text-warning"></i> </span>
                                        <span data-bind="visible: isWeekend()" title="Weekend" data-bs-toggle="tooltip"><i class="bi bi-calendar-x-fill text-danger"></i> </span>
                                        <span data-bind="visible: isBussinessDay()"><i class="bi bi-calendar-check-fill text-primary"></i> </span>
                                        <span data-bind="text: title"></span>
                                </h6>
                                <div class="d-flex align-items-center">
                                    <div class="progress" role="progressbar" style="width: 100px; height: 20px;" data-bind="visible: durationMs() > 0, attr: { 'aria-valuenow': durationMs(), title: duration() + ' logged' }" aria-valuemin="0" aria-valuemax="28800000">
                                        <div class="progress-bar overflow-visible text-light" data-bind="style: { width: durationPercentage() + '%' }, css: durationClass, text: duration"></div>
                                    </div>
                                    <button class="btn btn-sm py-0 px-1 me-2" data-bind="click: toggleLeave, visible: canToggleLeave, attr: { title: isLeave() ? 'Unmark as Leave' : 'Mark as Leave' }">
                                        <i class="bi bi-person-slash" data-bind="css: { 'text-info': isLeave(), 'text-muted': !isLeave() }"></i>
                                    </button>
                                    <!-- ko if: isBussinessDay -->
                                    <button data-bind="click: $root.openNewTodoModal" class="btn btn-sm btn-outline-secondary ms-2" type="button" title="New To-Do">
                                        <i class="bi bi-check2-square"></i>
                                    </button>
                                    <button data-bind="click: $root.openNewEntryModal" class="btn btn-sm btn-primary ms-2" type="button" title="New Entry">
                                        <i class="bi bi-plus-lg"></i>
                                    </button>
                                    <!-- /ko -->
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- ENTRIES -->
                                <ul data-bind="foreach: filteredEntries, visible: filteredEntries().length > 0" class="list-group list-group-flush">
                                    <li data-bind="css: { readOnly: readOnly, 'selected-entry': $data === $root.selectedEntry(), 'todo-entry': isTodo() }, attr: { id: 'entry-' + id() }" class="list-group-item px-0">
                                        <!-- ko ifnot: isTodo -->
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="fw-bold">
                                                    <span class="me-2" data-bind="attr: { title: task }, css: scopeClasses"></span>
                                                    <span data-bind="text: project"></span>
                                                    <span class="text-muted small" data-bind="text: task, visible: scope() !== 'global'"></span>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <i class="bi bi-stopwatch me-1"></i>
                                                <strong data-bind="text: duration"></strong>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-start mt-2">
                                            <p style="white-space: pre-wrap;" data-bind="html: formattedNotes" class="text-muted small mb-0 me-3"></p>
                                            <div data-bind="hidden: readOnly" class="flex-shrink-0">
                                                <div class="btn-group btn-group-sm">
                                                    <button data-bind="click: updateTime.bind($data, -1800000)" class="btn btn-outline-secondary" title="Subtract 30m"><i class="bi bi-dash"></i></button>
                                                    <button data-bind="click: updateTime.bind($data, 1800000)" class="btn btn-outline-secondary" title="Add 30m"><i class="bi bi-plus"></i></button>
                                                    <div class="btn-group" role="group">
                                                        <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" title="More actions"></button>
                                                        <ul class="dropdown-menu dropdown-menu-end">
                                                            <li><button class="dropdown-item" data-bind="click: edit"><i class="bi bi-pencil-square me-2"></i>Edit</button></li>
                                                            <li><button class="dropdown-item" data-bind="click: copy"><i class="bi bi-copy me-2"></i>Copy</button></li>
                                                            <li><button class="dropdown-item" data-bind="click: move"><i class="bi bi-calendar-event me-2"></i>Move</button></li>
                                                            <li><button class="dropdown-item text-danger" data-bind="click: remove"><i class="bi bi-trash me-2"></i>Remove</button></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /ko -->
                                        <!-- ko if: isTodo -->
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="fw-bold">
                                                    <span class="me-2" data-bind="css: scopeClasses"></span>
                                                    <span data-bind="text: project"></span>
                                                </div>
                                                <p style="white-space: pre-wrap;" data-bind="text: notes" class="text-muted small mb-0 mt-1"></p>
                                            </div>
                                            <div class="flex-shrink-0">
                                                <div class="btn-group btn-group-sm">
                                                    <button data-bind="click: confirmTodo" class="btn btn-success" title="Confirm"><i class="bi bi-check-lg me-1"></i></button>
                                                    <button data-bind="click: move" class="btn btn-secondary" title="Reschedule"><i class="bi bi-calendar-event me-1"></i></button>
                                                    <button data-bind="click: remove" class="btn btn-danger" title="Discard"><i class="bi bi-trash me-1"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /ko -->
                                    </li>
                                </ul>
                                <div data-bind="visible: filteredEntries().length === 0" class="text-center text-muted p-3">No entries yet</div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
                <!-- /ko -->
            </div>
        </div>

        <!-- Keybinding Mode Indicator -->
        <!-- ko if: keybindingsEnabled -->
        <div class="navigation-mode-indicator bg-secondary-subtle text-secondary-emphasis border rounded-pill shadow-sm" data-bind="if: navigationMode() !== 'none'">
            <i class="bi bi-keyboard-fill me-1"></i>
            <span data-bind="text: navigationMode() === 'day' ? 'Day Mode' : 'Entry Mode'"></span>
            <span class="ms-1">(<kbd>h</kbd> for help)</span>
        </div>
        <!-- /ko -->

        <!-- New Entry Modal -->
        <div class="modal fade" id="newEntryModal" tabindex="-1" aria-labelledby="newEntryModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-fullscreen-md-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="newEntryModalLabel" data-bind="text: selectedDayForNewEntry() ? 'New Entry for ' + selectedDayForNewEntry().title : ''"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <!-- ko with: selectedDayForNewEntry -->
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col-lg-5 mb-3 mb-lg-0">
                                <label class="form-label">Project <span class="text-danger">*</span></label>
                                <select data-bind="options: $root.projects, optionsText: 'name', value: project" class="form-select"></select>
                            </div>
                            <div class="col-lg-3 mb-3 mb-lg-0">
                                <label class="form-label">Scope</label>
                                <div class="btn-group w-100" role="group" data-bind="attr: { 'aria-label': 'Scope for ' + dateStr() }">
                                    <input type="radio" class="btn-check" value="global" data-bind="checked: scope, attr: { name: 'scope-type-modal-' + dateStr(), id: 'scope-global-modal-' + dateStr() }" autocomplete="off" checked>
                                    <label class="btn btn-outline-primary" data-bind="attr: { for: 'scope-global-modal-' + dateStr() }" title="Global"><i class="bi bi-globe-americas me-1"></i></label>

                                    <input type="radio" class="btn-check" value="task" data-bind="checked: scope, attr: { name: 'scope-type-modal-' + dateStr(), id: 'scope-task-modal-' + dateStr() }" autocomplete="off">
                                    <label class="btn btn-outline-primary" data-bind="attr: { for: 'scope-task-modal-' + dateStr() }" title="Task"><i class="bi bi-journal-check me-1"></i></label>

                                    <input type="radio" class="btn-check" value="supportTicket" data-bind="checked: scope, attr: { name: 'scope-type-modal-' + dateStr(), id: 'scope-support-ticket-modal-' + dateStr() }" autocomplete="off">
                                    <label class="btn btn-outline-primary" data-bind="attr: { for: 'scope-support-ticket-modal-' + dateStr() }" title="Support Ticket"><i class="bi bi-receipt me-1"></i></label>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <label class="form-label"><i class="bi bi-stopwatch"></i> Duration <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <button class="btn btn-outline-secondary" type="button" data-bind="click: updateTimeSpentInModal.bind($data, -1800000), attr: { disabled: $root.loading() }">
                                        <span class="d-none d-sm-inline">-30m</span>
                                        <span class="d-inline d-sm-none">-</span>
                                    </button>
                                    <input type="text" class="form-control text-center fw-bold" data-bind="value: time, event: { change: updateTimeFromInput }, attr: { disabled: $root.loading() }">
                                    <button class="btn btn-outline-secondary" type="button" data-bind="click: updateTimeSpentInModal.bind($data, 1800000), attr: { disabled: $root.loading() }">
                                        <span class="d-none d-sm-inline">+30m</span>
                                        <span class="d-inline d-sm-none">+</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3" data-bind="if: scope() !== 'global'">
                            <div data-bind="if: scope() === 'task'">
                                <label class="form-label">Task <span class="text-danger">*</span></label>
                                <div class="row g-2 mb-2">
                                    <div class="btn-group btn-group-sm flex-wrap" role="group" aria-label="Task status filter">
                                        <!-- ko foreach: taskStatusOptions -->
                                        <input type="radio" class="btn-check" data-bind="value: value, checked: $parent.taskStatusFilter, attr: { name: 'taskStatusFilter-' + $parent.dateStr(), id: 'status-' + value + '-' + $parent.dateStr() }">
                                        <label class="btn btn-outline-secondary" data-bind="text: text, attr: { for: 'status-' + value + '-' + $parent.dateStr() }"></label>
                                        <!-- /ko -->
                                    </div>
                                </div>
                                <!-- ko if: tasks().length > 0 -->
                                <div data-bind="if: tasks().length > 0">
                                    <select data-bind="
                                        options: tasks,
                                        optionsText: 'name',
                                        optionsValue: 'id',
                                        value: taskId,
                                        optionsCaption: 'Select Task...',
                                        select2: { theme: 'bootstrap-5', dropdownParent: $('#newEntryModal'), width: '100%' }"
                                        class="form-select"></select>
                                </div>
                                <!-- /ko -->
                                <!-- ko if: tasks().length === 0 && project() -->
                                <div class="form-text">No tasks for this project.</div>
                                <!-- /ko -->
                            </div>
                            <div data-bind="if: scope() === 'supportTicket'">
                                <label class="form-label">Support Ticket <span class="text-danger">*</span></label>
                                <!-- ko if: tickets().length > 0 -->
                                <select data-bind="
                                    options: tickets,
                                    optionsText: 'name',
                                    optionsValue: 'id',
                                    value: ticketId,
                                    optionsCaption: 'Select Support Ticket...',
                                    select2: { theme: 'bootstrap-5', dropdownParent: $('#newEntryModal'), width: '100%' }"
                                    class="form-select"></select>
                                <!-- /ko -->
                                <!-- ko if: tickets().length === 0 && project() -->
                                <div class="form-text">No support tickets for this project.</div>
                                <!-- /ko -->
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes <span class="text-danger">*</span></label>
                            <textarea placeholder="What did you work on?" data-bind="value: notes" name="notes" class="form-control" rows="5"></textarea>
                            <div class="form-text">Use <code>#hashtags</code> to display them as labels.</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-bind="attr: { disabled: $root.loading() }">Close</button>
                        <button type="button" class="btn btn-primary" data-bind="click: logEntry, attr: { disabled: !isLoggable() || $root.loading() }">Log Entry</button>
                    </div>
                    <!-- /ko -->
                </div>
            </div>
        </div>

        <!-- Edit Entry Modal -->
        <div class="modal fade" id="editEntryModal" tabindex="-1" aria-labelledby="editEntryModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-fullscreen-md-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editEntryModalLabel" data-bind="text: selectedEntryForEdit() ? 'Edit Entry for ' + selectedEntryForEdit().day.title : ''"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <!-- ko with: selectedEntryForEdit -->
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col-lg-5 mb-3 mb-lg-0">
                                <label class="form-label">Project <span class="text-danger">*</span></label>
                                <select data-bind="options: $root.projects, optionsText: 'name', value: edit_project" class="form-select"></select>
                            </div>
                            <div class="col-lg-3 mb-3 mb-lg-0">
                                <label class="form-label">Scope</label>
                                <div class="btn-group w-100" role="group" data-bind="attr: { 'aria-label': 'Scope for ' + id() }">
                                    <input type="radio" class="btn-check" value="global" data-bind="checked: edit_scope, attr: { name: 'edit-scope-type-modal-' + id(), id: 'edit-scope-global-modal-' + id() }" autocomplete="off">
                                    <label class="btn btn-outline-primary" data-bind="attr: { for: 'edit-scope-global-modal-' + id() }" title="Global"><i class="bi bi-globe-americas me-1"></i></label>

                                    <input type="radio" class="btn-check" value="task" data-bind="checked: edit_scope, attr: { name: 'edit-scope-type-modal-' + id(), id: 'edit-scope-task-modal-' + id() }" autocomplete="off">
                                    <label class="btn btn-outline-primary" data-bind="attr: { for: 'edit-scope-task-modal-' + id() }" title="Task"><i class="bi bi-journal-check me-1"></i></label>

                                    <input type="radio" class="btn-check" value="supportTicket" data-bind="checked: edit_scope, attr: { name: 'edit-scope-type-modal-' + id(), id: 'edit-scope-support-ticket-modal-' + id() }" autocomplete="off">
                                    <label class="btn btn-outline-primary" data-bind="attr: { for: 'edit-scope-support-ticket-modal-' + id() }" title="Support Ticket"><i class="bi bi-receipt me-1"></i></label>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <label class="form-label"><i class="bi bi-stopwatch"></i> Duration <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <button class="btn btn-outline-secondary" type="button" data-bind="click: updateEditTimeSpent.bind($data, -1800000), attr: { disabled: $root.loading() }">
                                        <span class="d-none d-sm-inline">-30m</span>
                                        <span class="d-inline d-sm-none">-</span>
                                    </button>
                                    <input type="text" class="form-control text-center fw-bold" data-bind="value: edit_time, event: { change: updateEditTimeFromInput }, attr: { disabled: $root.loading() }">
                                    <button class="btn btn-outline-secondary" type="button" data-bind="click: updateEditTimeSpent.bind($data, 1800000), attr: { disabled: $root.loading() }">
                                        <span class="d-none d-sm-inline">+30m</span>
                                        <span class="d-inline d-sm-none">+</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3" data-bind="if: edit_scope() !== 'global'">
                            <div data-bind="if: edit_scope() === 'task'">
                                <label class="form-label">Task <span class="text-danger">*</span></label>
                                <div class="row g-2 mb-2">
                                    <div class="btn-group btn-group-sm flex-wrap" role="group" aria-label="Task status filter">
                                        <!-- ko foreach: edit_taskStatusOptions -->
                                        <input type="radio" class="btn-check" data-bind="value: value, checked: $parent.edit_taskStatusFilter, attr: { name: 'edit_taskStatusFilter-' + $parent.id(), id: 'edit-status-' + value + '-' + $parent.id() }">
                                        <label class="btn btn-outline-secondary" data-bind="text: text, attr: { for: 'edit-status-' + value + '-' + $parent.id() }"></label>
                                        <!-- /ko -->
                                    </div>
                                </div>
                                <!-- ko if: edit_tasks().length > 0 -->
                                <div data-bind="if: edit_tasks().length > 0">
                                    <select data-bind="
                                        options: edit_tasks,
                                        optionsText: 'name',
                                        optionsValue: 'id',
                                        value: edit_taskId,
                                        optionsCaption: 'Select Task...',
                                        select2: { theme: 'bootstrap-5', dropdownParent: $('#editEntryModal'), width: '100%' }"
                                        class="form-select"></select>
                                </div>
                                <!-- /ko -->
                                <!-- ko if: edit_tasks().length === 0 && edit_project() -->
                                <div class="form-text">No tasks for this project.</div>
                                <!-- /ko -->
                            </div>
                            <div data-bind="if: edit_scope() === 'supportTicket'">
                                <label class="form-label">Support Ticket <span class="text-danger">*</span></label>
                                <!-- ko if: edit_tickets().length > 0 -->
                                <select data-bind="
                                    options: edit_tickets,
                                    optionsText: 'name',
                                    optionsValue: 'id',
                                    value: edit_ticketId,
                                    optionsCaption: 'Select Support Ticket...',
                                    select2: { theme: 'bootstrap-5', dropdownParent: $('#editEntryModal'), width: '100%' }"
                                    class="form-select"></select>
                                <!-- /ko -->
                                <!-- ko if: edit_tickets().length === 0 && edit_project() -->
                                <div class="form-text">No support tickets for this project.</div>
                                <!-- /ko -->
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes <span class="text-danger">*</span></label>
                            <textarea placeholder="What did you work on?" data-bind="value: edit_notes" name="notes" class="form-control" rows="5"></textarea>
                            <div class="form-text">Use <code>#hashtags</code> to display them as labels.</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-bind="attr: { disabled: $root.loading() }">Close</button>
                        <button type="button" class="btn btn-primary" data-bind="click: submitEdit, attr: { disabled: !isEditLoggable() || $root.loading() }">Save Changes</button>
                    </div>
                    <!-- /ko -->
                </div>
            </div>
        </div>

        <!-- New To-Do Modal -->
        <div class="modal fade" id="newTodoModal" tabindex="-1" aria-labelledby="newTodoModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-fullscreen-md-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="newTodoModalLabel" data-bind="text: selectedDayForNewEntry() ? 'New To-Do for ' + selectedDayForNewEntry().title : ''"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <!-- ko with: selectedDayForNewEntry -->
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Project <span class="text-danger">*</span></label>
                            <select data-bind="options: $root.projects, optionsText: 'name', value: project" class="form-select"></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes <span class="text-danger">*</span></label>
                            <textarea placeholder="What needs to be done?" data-bind="value: notes" name="notes" class="form-control" rows="5"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-bind="attr: { disabled: $root.loading() }">Close</button>
                        <button type="button" class="btn btn-primary" data-bind="click: logTodo, attr: { disabled: !isTodoLoggable() || $root.loading() }">Log To-Do</button>
                    </div>
                    <!-- /ko -->
                </div>
            </div>
        </div>

        <!-- Remove Confirmation Modal -->
        <div class="modal fade" id="removeConfirmModal" tabindex="-1" aria-labelledby="removeConfirmModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="removeConfirmModalLabel">Confirm Deletion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this time entry?</p>
                        <!-- ko with: entryForRemoval -->
                        <div data-bind="css: { 'bg-dark': $root.isDarkMode(), 'bg-light': !$root.isDarkMode() }" class="card bg-light">
                            <div class="card-body">
                                <p class="mb-0"><strong>Date:</strong> <span data-bind="text: day.title"></span></p>
                                <p class="mb-0"><strong>Project:</strong> <span data-bind="text: project"></span></p>
                                <p class="mb-0"><strong>Duration:</strong> <span data-bind="text: duration"></span></p>
                                <p class="mb-0"><strong>Notes:</strong> <span style="white-space: pre-wrap;" data-bind="text: notes"></span></p>
                            </div>
                        </div>
                        <!-- /ko -->
                        <p class="mt-2 text-danger"><i class="bi bi-exclamation-triangle-fill"></i> This action cannot be undone.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-bind="attr: { disabled: loading }">Cancel</button>
                        <button type="button" class="btn btn-danger" data-bind="click: submitRemove, attr: { disabled: loading }">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Copy Entry Modal -->
        <div class="modal fade" id="copyEntryModal" tabindex="-1" aria-labelledby="copyEntryModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="copyEntryModalLabel">Copy Entry</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Select a date to copy the entry to:</p>
                        <div id="copy-entry-calendar"></div>
                        <!-- ko with: entryForCopy -->
                        <div data-bind="css: { 'bg-dark': $root.isDarkMode(), 'bg-light': !$root.isDarkMode() }" class="card bg-light mt-3">
                            <div class="card-body">
                                <p class="mb-0"><strong>Project:</strong> <span data-bind="text: project"></span></p>
                                <p class="mb-0"><strong>Duration:</strong> <span data-bind="text: duration"></span></p>
                                <p class="mb-0"><strong>Notes:</strong> <span style="white-space: pre-wrap;" data-bind="text: notes"></span></p>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-bind="attr: { disabled: loading }">Cancel</button>
                        <button type="button" class="btn btn-primary" data-bind="click: submitCopy, attr: { disabled: !selectedDateForCopy() || loading() }">Copy</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Move Entry Modal -->
        <div class="modal fade" id="moveEntryModal" tabindex="-1" aria-labelledby="moveEntryModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="moveEntryModalLabel">Move Entry</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Select a date to move the entry to:</p>
                        <div id="move-entry-calendar"></div>
                        <!-- ko with: entryForMove -->
                        <div data-bind="css: { 'bg-dark': $root.isDarkMode(), 'bg-light': !$root.isDarkMode() }" class="card bg-light mt-3">
                            <div class="card-body">
                                <p class="mb-0"><strong>Project:</strong> <span data-bind="text: project"></span></p>
                                <p class="mb-0"><strong>Duration:</strong> <span data-bind="text: duration"></span></p>
                                <p class="mb-0"><strong>Notes:</strong> <span style="white-space: pre-wrap;" data-bind="text: notes"></span></p>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-bind="attr: { disabled: loading }">Cancel</button>
                        <button type="button" class="btn btn-primary" data-bind="click: submitMove, attr: { disabled: !selectedDateForMove() || loading() }">Move</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pomodoro Modal -->
        <div class="modal fade" id="pomodoroModal" tabindex="-1" aria-labelledby="pomodoroModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="pomodoroModalLabel"><i class="bi bi-stopwatch-fill text-danger me-2"></i>Focus Session</h5>
                    </div>
                    <div class="modal-body text-center">
                        <h1 class="display-1 fw-bold" data-bind="text: pomodoroDisplayTime, css: { 'text-danger': pomodoroFinished }"></h1>
                        <div class="mb-3 w-75 mx-auto" data-bind="if: !pomodoroIsRunning()">
                            <label for="pomodoroDuration" class="form-label">Session duration (minutes)</label>
                            <input type="number" class="form-control" id="pomodoroDuration" data-bind="value: pomodoroDurationMinutes">
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-center border-0">
                        <!-- ko ifnot: pomodoroIsRunning -->
                        <button type="button" class="btn btn-success btn-lg" data-bind="click: startPomodoro">Start</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <!-- /ko -->
                        <!-- ko if: pomodoroIsRunning -->
                        <button type="button" class="btn btn-danger" data-bind="click: stopPomodoro">
                            <i class="bi bi-stop-fill"></i> Stop
                        </button>
                        <button type="button" class="btn btn-warning" data-bind="click: restartPomodoro">
                            <i class="bi bi-arrow-clockwise"></i> Restart
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hide</button>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Keybindings Help Modal -->
        <div class="modal fade" id="keybindingsHelpModal" tabindex="-1" aria-labelledby="keybindingsHelpModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-fullscreen-md-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="keybindingsHelpModalLabel"><i class="bi bi-keyboard-fill me-2"></i>Keybindings Help</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="mb-3">General</h5>
                                <ul class="list-group list-group-flush mb-4">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Toggle Keybindings
                                        <span><kbd>v</kbd></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Show this Help
                                        <span><kbd>h</kbd></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Open Pomodoro Timer
                                        <span><kbd>p</kbd></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Close Modal / Unfocus
                                        <span><kbd>Esc</kbd> or <kbd>q</kbd></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Full Page Refresh
                                        <span><kbd>Ctrl</kbd>+<kbd>r</kbd></span>
                                    </li>
                                </ul>

                                <h5 class="mb-3">Navigation</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Move Selection
                                        <span><kbd>j</kbd> <kbd>k</kbd> or <kbd></kbd> <kbd></kbd></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Go to First/Last Item
                                        <span><kbd>g</kbd> / <kbd>G</kbd></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Go to Today
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Day Mode</span>
                                            <kbd>T</kbd>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Switch to Entry Mode
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Day Mode</span>
                                            <kbd>Enter</kbd>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Return to Day Mode
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Entry Mode</span>
                                            <span><kbd>Esc</kbd> or <kbd>q</kbd></span>
                                        </span>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5 class="mb-3">Actions</h5>
                                <ul class="list-group list-group-flush mb-4">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Add New Entry
                                        <span><kbd>a</kbd></span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Add New To-Do
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Day Mode</span>
                                            <kbd>t</kbd>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Edit Selected Entry
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Entry Mode</span>
                                            <kbd>e</kbd>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Remove Selected Entry
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Entry Mode</span>
                                            <kbd>r</kbd>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Adjust Entry Time (+/- 30m)
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Entry Mode</span>
                                            <span><kbd>+</kbd> / <kbd>-</kbd></span>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Refresh Day Data
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Day Mode</span>
                                            <kbd>r</kbd>
                                        </span>
                                    </li>
                                </ul>

                                <h5 class="mb-3">Clipboard</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Copy Entry
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Entry Mode</span>
                                            <span><kbd>Ctrl</kbd>+<kbd>c</kbd></span>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Cut Entry
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Entry Mode</span>
                                            <span><kbd>Ctrl</kbd>+<kbd>x</kbd></span>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Paste Entry
                                        <span><kbd>Ctrl</kbd>+<kbd>v</kbd></span>
                                    </li>
                                </ul>

                                <h5 class="mb-3">Pomodoro Timer (in modal)</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Start Timer
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Not Running</span>
                                            <kbd>Enter</kbd>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Stop Timer
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Running</span>
                                            <kbd>s</kbd>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Restart Timer
                                        <span class="text-end">
                                            <span class="badge bg-secondary-subtle text-secondary-emphasis me-2">Running</span>
                                            <kbd>r</kbd>
                                        </span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        Hide Timer
                                        <span><kbd>h</kbd></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <button type="button" class="btn btn-primary rounded-circle shadow-lg" id="back-to-top-btn" title="Back to top">
        <i class="bi bi-arrow-up fs-4"></i>
    </button>

    <footer class="text-center text-body-secondary py-3 mt-5 border-top">
        <p class="mb-0">
            Made with <i class="bi bi-heart-fill text-danger"></i> by a tired panda
            <span class="mx-2">|</span>
            <a href="https://github.com/espinosajuanma/solutions-time-tracking" target="_blank" class="text-body-secondary">
                <i class="bi bi-github"></i> Contribute
            </a>
            <span class="mx-2">|</span>
            <a href="https://slingrhq.slack.com/archives/C0A11LQ5Z3N" target="_blank" class="text-body-secondary">
                <i class="bi bi-slack"></i> Contact
            </a>
        </p>
    </footer>

    <!-- Toasts -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <!-- ko foreach: toasts -->
        <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bind="attr: { id: id }">
            <div class="toast-header">
                <i class="bi me-2" data-bind="css: { 'bi-info-circle-fill text-info': info, 'bi-exclamation-triangle-fill text-warning': warning, 'bi-x-circle-fill text-danger': error, 'bi-check-circle-fill text-success': success }"></i>
                <strong class="me-auto" data-bind="text: title"></strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" data-bind="text: msg">
            </div>
        </div>
        <!-- /ko -->
    </div>
</body>
</html>